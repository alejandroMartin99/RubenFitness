<div class="profile-page">
  <div class="header">
    <div class="avatar" [class.has-photo]="photoPreview">
      <img *ngIf="photoPreview; else avatarFallback" [src]="photoPreview" alt="Avatar" />
      <ng-template #avatarFallback>
        <mat-icon>account_circle</mat-icon>
      </ng-template>
    </div>
    <div class="header-actions">
      <button mat-stroked-button color="primary" type="button" (click)="fileInput.click()">
        <mat-icon>upload</mat-icon>
        Subir foto
      </button>
      <input #fileInput type="file" accept="image/*" (change)="onPhotoSelected($event)" hidden />
    </div>
    <div class="header-text">
      <h1>Tu Perfil</h1>
      <p>Configura tus datos para personalizar el plan.</p>
    </div>
  </div>

  <div class="content">
    <mat-card class="card">
      <form [formGroup]="form" (ngSubmit)="save()">
        <mat-horizontal-stepper>
          <mat-step label="Datos básicos">
            <div class="grid">
              <mat-form-field appearance="outline"><mat-label>Nombre</mat-label><input matInput formControlName="fullName" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Género</mat-label><mat-select formControlName="gender"><mat-option value="male">Hombre</mat-option><mat-option value="female">Mujer</mat-option><mat-option value="other">Otro</mat-option></mat-select></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Fecha de nacimiento</mat-label><input matInput type="date" formControlName="birthDate" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Altura (cm)</mat-label><input matInput type="number" formControlName="heightCm" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Peso (kg)</mat-label><input matInput type="number" formControlName="weightKg" /></mat-form-field>
              <div class="toggle"><label>Nivel de actividad</label><mat-button-toggle-group formControlName="activityLevel" appearance="legacy"><mat-button-toggle value="low">Bajo</mat-button-toggle><mat-button-toggle value="medium">Medio</mat-button-toggle><mat-button-toggle value="high">Alto</mat-button-toggle></mat-button-toggle-group></div>
              <mat-form-field appearance="outline"><mat-label>Email de contacto</mat-label><input matInput formControlName="email" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Teléfono</mat-label><input matInput formControlName="phone" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Dirección</mat-label><input matInput formControlName="address" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Ciudad</mat-label><input matInput formControlName="city" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>País</mat-label><input matInput formControlName="country" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Contacto de emergencia</mat-label><input matInput placeholder="Nombre" formControlName="emergencyName" /></mat-form-field>
              <mat-form-field appearance="outline"><mat-label>Teléfono de emergencia</mat-label><input matInput formControlName="emergencyPhone" /></mat-form-field>
            </div>
            <div class="step-actions"><button mat-raised-button color="primary" matStepperNext>Siguiente</button></div>
          </mat-step>
          <mat-step label="Objetivo y complexión">
            <div class="chips"><label>Objetivo principal</label><mat-chip-listbox formControlName="goal" class="chip-list"><mat-chip-option value="fat_loss">Perder grasa</mat-chip-option><mat-chip-option value="muscle_gain">Ganar músculo</mat-chip-option><mat-chip-option value="performance">Rendimiento</mat-chip-option><mat-chip-option value="health">Salud</mat-chip-option></mat-chip-listbox></div>
            <div class="toggle"><label>Frecuencia semanal</label><mat-button-toggle-group formControlName="frequency" appearance="legacy"><mat-button-toggle value="2">2 días</mat-button-toggle><mat-button-toggle value="3">3 días</mat-button-toggle><mat-button-toggle value="4">4 días</mat-button-toggle><mat-button-toggle value="5">5+ días</mat-button-toggle></mat-button-toggle-group></div>
            <div class="chips"><label>Tipo de complexión</label><mat-chip-listbox formControlName="complexion" class="chip-list"><mat-chip-option value="ectomorph">Ectomorfo</mat-chip-option><mat-chip-option value="mesomorph">Mesomorfo</mat-chip-option><mat-chip-option value="endomorph">Endomorfo</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Experiencia</label><mat-chip-listbox formControlName="experience" class="chip-list"><mat-chip-option value="beginner">Principiante</mat-chip-option><mat-chip-option value="intermediate">Intermedio</mat-chip-option><mat-chip-option value="advanced">Avanzado</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Acceso a equipo</label><mat-chip-listbox formControlName="equipment" class="chip-list" multiple><mat-chip-option value="gym">Gimnasio</mat-chip-option><mat-chip-option value="dumbbells">Mancuernas</mat-chip-option><mat-chip-option value="barbell">Barra</mat-chip-option><mat-chip-option value="bands">Bandas</mat-chip-option><mat-chip-option value="bodyweight">Peso corporal</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Disponibilidad</label><mat-chip-listbox formControlName="availability" class="chip-list" multiple><mat-chip-option value="morning">Mañanas</mat-chip-option><mat-chip-option value="noon">Medio día</mat-chip-option><mat-chip-option value="evening">Tardes</mat-chip-option></mat-chip-listbox></div>
            <div class="step-actions"><button mat-stroked-button matStepperPrevious>Volver</button><button mat-raised-button color="primary" matStepperNext>Siguiente</button></div>
          </mat-step>
          <mat-step label="Hábitos">
            <div class="chips"><label>Patrón de sueño</label><mat-chip-listbox formControlName="sleep" class="chip-list"><mat-chip-option value="<6h">Menos de 6h</mat-chip-option><mat-chip-option value="6-7h">6-7h</mat-chip-option><mat-chip-option value=">7h">Más de 7h</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Ingesta de agua</label><mat-chip-listbox formControlName="water" class="chip-list"><mat-chip-option value="<1L">Menos de 1L</mat-chip-option><mat-chip-option value="1-2L">1-2L</mat-chip-option><mat-chip-option value=">2L">Más de 2L</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Alimentación</label><mat-chip-listbox formControlName="diet" class="chip-list"><mat-chip-option value="balanceada">Balanceada</mat-chip-option><mat-chip-option value="alta_prote">Alta en proteína</mat-chip-option><mat-chip-option value="vegetariana">Vegetariana</mat-chip-option><mat-chip-option value="vegana">Vegana</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Preferencias de entrenamiento</label><mat-chip-listbox formControlName="trainingPrefs" class="chip-list" multiple><mat-chip-option value="fuerza">Fuerza</mat-chip-option><mat-chip-option value="cardio">Cardio</mat-chip-option><mat-chip-option value="hiit">HIIT</mat-chip-option><mat-chip-option value="movilidad">Movilidad</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Preferencia nutricional</label><mat-chip-listbox formControlName="nutritionPref" class="chip-list"><mat-chip-option value="balanceada">Balanceada</mat-chip-option><mat-chip-option value="vegana">Vegana</mat-chip-option><mat-chip-option value="vegetariana">Vegetariana</mat-chip-option><mat-chip-option value="keto">Keto</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Sueño habitual</label><mat-chip-listbox formControlName="sleepTime" class="chip-list"><mat-chip-option value="22:00">22:00</mat-chip-option><mat-chip-option value="23:00">23:00</mat-chip-option><mat-chip-option value="00:00">00:00</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Nivel de estrés</label><mat-chip-listbox formControlName="stress" class="chip-list"><mat-chip-option value="bajo">Bajo</mat-chip-option><mat-chip-option value="medio">Medio</mat-chip-option><mat-chip-option value="alto">Alto</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Hábitos</label><mat-chip-listbox formControlName="habitsQuick" class="chip-list" multiple><mat-chip-option value="alcohol">Alcohol</mat-chip-option><mat-chip-option value="tabaco">Tabaco</mat-chip-option><mat-chip-option value="sedentarismo">Sedentarismo</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Lesiones/Condiciones</label><mat-chip-listbox formControlName="injuries" class="chip-list" multiple><mat-chip-option value="espalda">Espalda</mat-chip-option><mat-chip-option value="rodilla">Rodilla</mat-chip-option><mat-chip-option value="hombro">Hombro</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Alergias/Intolerancias</label><mat-chip-listbox formControlName="allergies" class="chip-list" multiple><mat-chip-option value="gluten">Gluten</mat-chip-option><mat-chip-option value="lactosa">Lactosa</mat-chip-option><mat-chip-option value="frutos secos">Frutos secos</mat-chip-option></mat-chip-listbox></div>
            <div class="chips"><label>Antecedentes familiares</label><mat-chip-listbox formControlName="familyHistory" class="chip-list" multiple><mat-chip-option value="cardio">Cardiovasculares</mat-chip-option><mat-chip-option value="diabetes">Diabetes</mat-chip-option><mat-chip-option value="obesidad">Obesidad</mat-chip-option></mat-chip-listbox></div>
            <div class="actions"><button mat-stroked-button matStepperPrevious>Volver</button><button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Guardar</button></div>
          </mat-step>
        </mat-horizontal-stepper>
      </form>
    </mat-card>

    <div class="summary" *ngIf="showSummary">
      <div class="photo"><img *ngIf="photoPreview; else noPhoto2" [src]="photoPreview" alt="Avatar" /><ng-template #noPhoto2><mat-icon>account_circle</mat-icon></ng-template></div>
      <mat-card class="summary-card">
        <div class="rows">
          <div class="row"><span>Nombre</span><strong>{{ form.value.fullName || '-' }}</strong></div>
          <div class="row"><span>Género</span><strong>{{ form.value.gender }}</strong></div>
          <div class="row"><span>Nacimiento</span><strong>{{ form.value.birthDate || '-' }}</strong></div>
          <div class="row"><span>Altura</span><strong>{{ form.value.heightCm || '-' }} cm</strong></div>
          <div class="row"><span>Peso</span><strong>{{ form.value.weightKg || '-' }} kg</strong></div>
          <div class="row"><span>Actividad</span><strong>{{ form.value.activityLevel }}</strong></div>
          <div class="row"><span>Objetivo</span><strong>{{ form.value.goal }}</strong></div>
          <div class="row"><span>Frecuencia</span><strong>{{ form.value.frequency }} días</strong></div>
          <div class="row"><span>Complexión</span><strong>{{ form.value.complexion }}</strong></div>
          <div class="row"><span>Sueño</span><strong>{{ form.value.sleep }}</strong></div>
          <div class="row"><span>Agua</span><strong>{{ form.value.water }}</strong></div>
          <div class="row"><span>Dieta</span><strong>{{ form.value.diet }}</strong></div>
          <div class="row full"><span>Hábitos</span><strong>{{ (form.value.habitsQuick?.length ? (form.value.habitsQuick | json) : '') | slice:1:-1 }} {{ form.value.habits }}</strong></div>
        </div>
        <div class="summary-actions"><button mat-stroked-button (click)="showSummary=false">Editar</button></div>
      </mat-card>
    </div>
  </div>
</div>


