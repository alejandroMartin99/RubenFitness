<div class="progress-container">
  <!-- Header -->
  <div class="progress-header">
    <h2>
      <mat-icon>bar_chart</mat-icon>
      Your Progress
    </h2>
    <p>Track your fitness journey and celebrate your achievements</p>
  </div>

  <!-- Grid layout: 2 columns -->
  <div class="top-grid">
    <!-- Quick log -->
    <mat-card class="panel-card">
      <mat-card-header>
        <mat-card-title>
          <div class="title-row">
            <mat-icon>playlist_add_check</mat-icon>
            Registrar entrenamiento
          </div>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="workoutForm" class="log-form simple" (ngSubmit)="submitWorkout()">
          <input class="input" type="date" formControlName="date" />

          <select class="input select" formControlName="type">
            <option *ngFor="let t of workoutTypes" [value]="t">{{ t }}</option>
          </select>

          <textarea class="input textarea" rows="3" formControlName="notes" placeholder="Notas (opcional)"></textarea>

          <div class="title-row small">
            <mat-icon>fitness_center</mat-icon>
            Ejercicios (mín. 5)
          </div>

          <div class="exercise-list simple" formArrayName="exercises">
            <div class="exercise-item simple" *ngFor="let ex of exercises.controls; let i = index" [formGroupName]="i">
              <input class="input" formControlName="name" placeholder="Ejercicio" />
              <div class="exercise-inline">
                <div class="sets-table">
                  <div class="sets-header">
                    <span>#</span>
                    <span>Reps</span>
                    <span>Peso (kg)</span>
                    <span></span>
                  </div>
                  <div class="set-row" *ngFor="let st of getSets(i).controls; let j = index" [formGroupName]="j">
                    <span class="index">{{ j + 1 }}</span>
                    <input class="input" type="number" formControlName="reps" placeholder="Reps" />
                    <input class="input" type="number" formControlName="weight" placeholder="Peso" />
                    <button mat-icon-button type="button" (click)="removeSet(i, j)" [disabled]="getSets(i).length === 1">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                  <button mat-stroked-button color="primary" type="button" (click)="addSet(i)">Añadir serie</button>
                </div>
                <div class="exercise-thumb" *ngIf="exerciseImage(ex.value?.name)">
                  <img [src]="exerciseImage(ex.value?.name)!" alt="exercise" />
                </div>
                <button mat-icon-button type="button" (click)="removeExercise(i)" [disabled]="exercises.length === 1">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
            <button mat-stroked-button color="primary" type="button" (click)="addExercise()">Añadir ejercicio</button>
          </div>

          <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="workoutForm.invalid">Guardar entrenamiento</button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Visualizer + body comp -->
    <div class="right-column">
      <app-body-visualizer [muscles]="selectedMuscles"></app-body-visualizer>

      <mat-card class="panel-card">
        <mat-card-header>
          <mat-card-title>
            <div class="title-row">
              <mat-icon>monitor_weight</mat-icon>
              Composición corporal
            </div>
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="body-grid">
            <div class="body-item">
              <div class="label">Masa muscular</div>
              <div class="value">{{ bodyComp.muscle }} kg</div>
            </div>
            <div class="body-item">
              <div class="label">Grasa corporal</div>
              <div class="value">{{ bodyComp.fat }} %</div>
            </div>
            <div class="body-item">
              <div class="label">Peso</div>
              <div class="value">{{ bodyComp.weight }} kg</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Tabs Navigation -->
  <mat-tab-group class="progress-tabs" animationDuration="300ms">
    <!-- Overview Tab -->
    <mat-tab label="Overview">
      <ng-template matTabContent>
        <!-- Recent Workouts -->
        <div class="recent-workouts" *ngIf="summary">
        <h3 class="section-title">
          <mat-icon>history</mat-icon>
          Recent Workouts
        </h3>

        <!-- No workouts message -->
        <mat-card class="empty-state" *ngIf="summary.recentWorkouts.length === 0">
          <mat-icon>inbox</mat-icon>
          <h4>No workouts yet</h4>
          <p>Start tracking your progress by completing your first workout!</p>
        </mat-card>

        <!-- Workouts list -->
        <div class="workouts-list" *ngIf="summary.recentWorkouts.length > 0">
          <mat-card class="workout-item" *ngFor="let workout of summary.recentWorkouts">
            <mat-card-content>
              <div class="workout-content">
                <div class="workout-info">
                  <h4>{{ workout.name }}</h4>
                  <p class="workout-date">
                    <mat-icon>calendar_today</mat-icon>
                    {{ workout.date | date:'fullDate' }}
                  </p>
                  <p class="workout-duration" *ngIf="workout.durationMinutes">
                    <mat-icon>schedule</mat-icon>
                    {{ workout.durationMinutes }} minutes
                  </p>
                </div>
                <div class="workout-status">
                  <mat-icon class="success">check_circle</mat-icon>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      </ng-template>
    </mat-tab>

    <!-- Charts Tab -->
    <mat-tab label="Analytics">
      <ng-template matTabContent>
        <app-progress-charts></app-progress-charts>
      </ng-template>
    </mat-tab>

    <!-- Before & After Tab -->
    <mat-tab label="Before & After">
      <ng-template matTabContent>
        <app-before-after></app-before-after>
      </ng-template>
    </mat-tab>
  </mat-tab-group>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading your progress...</p>
  </div>
</div>

