<div class="before-after-container">
  <div class="header-section">
    <h3>
      <mat-icon>compare_arrows</mat-icon>
      Before & After Progress
    </h3>
    <p>Track your transformation with photos and measurements</p>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button mat-raised-button color="primary" (click)="openUploadDialog('before')">
      <mat-icon>add_photo_alternate</mat-icon>
      Upload Before Photo
    </button>
    <button mat-raised-button color="accent" (click)="openUploadDialog('after')">
      <mat-icon>add_photo_alternate</mat-icon>
      Upload After Photo
    </button>
  </div>

  <!-- Photos Grid -->
  <div class="photos-section" *ngIf="!loading">
    <!-- Before Photos -->
    <div class="photo-category">
      <h4>
        <mat-icon>arrow_back</mat-icon>
        Before Photos
        <span class="count">({{ beforePhotos.length }})</span>
      </h4>
      <div class="photos-grid" *ngIf="beforePhotos.length > 0">
        <mat-card class="photo-card" *ngFor="let photo of beforePhotos">
          <img [src]="photo.thumbnailUrl || photo.photoUrl" [alt]="'Before photo from ' + (photo.takenAt | date:'short')" />
          <div class="photo-overlay">
            <div class="photo-actions">
              <button mat-icon-button (click)="selectedPhoto = photo" matTooltip="View Details">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deletePhoto(photo)" matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div class="photo-date">
              {{ photo.takenAt | date:'shortDate' }}
            </div>
          </div>
        </mat-card>
      </div>
      <div class="empty-state" *ngIf="beforePhotos.length === 0">
        <mat-icon>photo_camera</mat-icon>
        <p>No before photos yet</p>
      </div>
    </div>

    <!-- After Photos -->
    <div class="photo-category">
      <h4>
        <mat-icon>arrow_forward</mat-icon>
        After Photos
        <span class="count">({{ afterPhotos.length }})</span>
      </h4>
      <div class="photos-grid" *ngIf="afterPhotos.length > 0">
        <mat-card class="photo-card" *ngFor="let photo of afterPhotos">
          <img [src]="photo.thumbnailUrl || photo.photoUrl" [alt]="'After photo from ' + (photo.takenAt | date:'short')" />
          <div class="photo-overlay">
            <div class="photo-actions">
              <button mat-icon-button (click)="selectedPhoto = photo" matTooltip="View Details">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deletePhoto(photo)" matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div class="photo-date">
              {{ photo.takenAt | date:'shortDate' }}
            </div>
          </div>
        </mat-card>
      </div>
      <div class="empty-state" *ngIf="afterPhotos.length === 0">
        <mat-icon>photo_camera</mat-icon>
        <p>No after photos yet</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading photos...</p>
  </div>

  <!-- Upload Dialog -->
  <div class="upload-dialog-overlay" *ngIf="showUploadDialog" (click)="closeUploadDialog()">
    <mat-card class="upload-dialog" (click)="$event.stopPropagation()">
      <mat-card-header>
        <mat-card-title>
          Upload {{ selectedPhotoType === 'before' ? 'Before' : 'After' }} Photo
        </mat-card-title>
        <button mat-icon-button (click)="closeUploadDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>
        <div class="upload-form">
          <!-- Photo Preview -->
          <div class="photo-preview" *ngIf="photoPreview">
            <img [src]="photoPreview" alt="Preview" />
          </div>

          <!-- File Input -->
          <div class="file-input-wrapper">
            <input type="file" accept="image/*" (change)="onFileSelected($event)" id="photoFile" />
            <label for="photoFile" class="file-label">
              <mat-icon>cloud_upload</mat-icon>
              <span>{{ photoFile ? photoFile.name : 'Choose Photo' }}</span>
            </label>
          </div>

          <!-- Notes -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notes (optional)</mat-label>
            <textarea matInput [(ngModel)]="photoNotes" rows="3" placeholder="Add any notes about this photo..."></textarea>
          </mat-form-field>

          <!-- Measurements -->
          <div class="measurements-section">
            <h5>Measurements (optional)</h5>
            <div class="measurements-grid">
              <mat-form-field appearance="outline">
                <mat-label>Weight (kg)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.weight" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Body Fat (%)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.bodyFat" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Chest (cm)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.chest" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Waist (cm)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.waist" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Hips (cm)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.hips" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Arms (cm)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.arms" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Thighs (cm)</mat-label>
                <input matInput type="number" [(ngModel)]="measurements.thighs" />
              </mat-form-field>
            </div>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button (click)="closeUploadDialog()" [disabled]="uploading">Cancel</button>
        <button mat-raised-button color="primary" (click)="uploadPhoto()" [disabled]="!photoFile || uploading">
          <mat-spinner diameter="20" *ngIf="uploading"></mat-spinner>
          <span *ngIf="!uploading">Upload</span>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Photo Detail Dialog -->
  <div class="photo-detail-overlay" *ngIf="selectedPhoto && !showComparisonView" (click)="selectedPhoto = null">
    <mat-card class="photo-detail-card" (click)="$event.stopPropagation()">
      <mat-card-header>
        <mat-card-title>{{ selectedPhoto.photoType === 'before' ? 'Before' : 'After' }} Photo</mat-card-title>
        <button mat-icon-button (click)="selectedPhoto = null">
          <mat-icon>close</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>
        <img [src]="selectedPhoto.photoUrl" [alt]="selectedPhoto.photoType + ' photo'" />
        <div class="photo-info" *ngIf="selectedPhoto.notes || selectedPhoto.measurements">
          <p *ngIf="selectedPhoto.notes"><strong>Notes:</strong> {{ selectedPhoto.notes }}</p>
          <div *ngIf="selectedPhoto.measurements" class="measurements-display">
            <h5>Measurements:</h5>
            <div class="measurements-list">
              <span *ngIf="selectedPhoto.measurements?.weight">Weight: {{ selectedPhoto.measurements.weight }} kg</span>
              <span *ngIf="selectedPhoto.measurements?.bodyFat">Body Fat: {{ selectedPhoto.measurements.bodyFat }}%</span>
              <span *ngIf="selectedPhoto.measurements?.measurements?.chest">Chest: {{ selectedPhoto.measurements.measurements.chest }} cm</span>
              <span *ngIf="selectedPhoto.measurements?.measurements?.waist">Waist: {{ selectedPhoto.measurements.measurements.waist }} cm</span>
              <span *ngIf="selectedPhoto.measurements?.measurements?.hips">Hips: {{ selectedPhoto.measurements.measurements.hips }} cm</span>
            </div>
          </div>
        </div>
        <p class="photo-date">Taken on: {{ selectedPhoto.takenAt | date:'full' }}</p>
      </mat-card-content>
    </mat-card>
  </div>
</div>

